<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Chatbot Sustentabilidade</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>Chatbot Sustentabilidade ðŸŒ±</h1>
    <div class="box">
      <input class="input" type="text" placeholder="Digite sua pergunta..." id="userInput">
      <div class="actions">
        <button id="sendBtn" class="animated-button">Enviar Pergunta</button>
        <button id="clearBtn" class="animated-button">Limpar HistÃ³rico</button>
      </div>
      <div id="chatbox"></div>
    </div>
  </div>

  <script>
    const chatbox = document.getElementById("chatbox");
    const inputField = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const clearBtn = document.getElementById("clearBtn");

    async function sendMessage() {
        const pergunta = inputField.value.trim();
        if(!pergunta) return;
        inputField.value = "";
        chatbox.innerHTML += `<div class="user-msg"><b>VocÃª:</b> ${pergunta}</div>`;
        chatbox.innerHTML += `<div class="bot-msg"><b>Bot:</b> Processando...</div>`;
        chatbox.scrollTop = chatbox.scrollHeight;

        const response = await fetch("/send_message", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({pergunta})
        });
        const data = await response.json();
        chatbox.querySelector(".bot-msg:last-child").remove();
        chatbox.innerHTML += `<div class="bot-msg"><b>Bot:</b> ${data.resposta}</div>`;
        if(data.resumo) chatbox.innerHTML += `<div class="resumo"><b>Resumo:</b> ${data.resumo}</div>`;
        chatbox.scrollTop = chatbox.scrollHeight;
    }

    
    sendBtn.onclick = sendMessage;
    
    clearBtn.onclick = async () => {
        await fetch("/clear_history", {method:"POST"});
        chatbox.innerHTML = "";
    };

    // input usando a tecla enter
    inputField.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            sendMessage();
        }
    });
  </script>
</body>
</html>
